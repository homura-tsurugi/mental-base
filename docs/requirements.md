# ライフ・ワークガバナンス プラットフォーム（MVP） - 要件定義書

**バージョン**: 1.0.0 (MVP)
**最終更新日**: 2025-11-01
**ステータス**: 確定

---

## 要件定義の作成原則

- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

---

## 1. プロジェクト概要

### 1.1 成果目標（MVP）

**MVPで実現する最終成果**

クライアント（ユーザー）がAIからの個別アドバイスとフィードバックを受けながら、COM:PASSサイクル（計画→実行→振り返り→改善）で自律的に目標達成を進められるモバイルWebアプリケーション。

**実装範囲の確定**
- ✅ ユーザー種別: クライアント（ユーザー）サイドのみ
- ✅ COM:PASSサイクル: 完全実装（PLAN + DO + Check + Action）
- ✅ AI連携: アドバイス・ログ分析・フィードバック生成
- ✅ 認証方式: メール＋パスワード
- ❌ メンター機能: フェーズ2以降に実装
- ❌ 組織管理機能: フェーズ2以降に実装

### 1.2 成功指標

#### 定量的指標
1. **クライアントが2週間継続してログを記録できる**
2. **AIが記録内容を分析して具体的なフィードバックを返せる**
3. **クライアントがAIアドバイスに基づいて週1回以上行動を改善できる**

#### 定性的指標
1. **クライアントが「AIのアドバイスが具体的で役立つ」と感じる**
2. **クライアントが「進捗が可視化されて続けやすい」と感じる**
3. **クライアントが「システムが自分の成長を加速させている」と感じる**

---

## 2. システム全体像

### 2.1 主要機能一覧

#### COM:PASSサイクル管理
- **PLAN（計画）**: 目標設定、コミットメント確認、アクションプラン作成
- **DO（実行）**: タスク実行、日々のログ記録、リマインダー
- **Check（振り返り）**: 進捗確認、データ可視化、振り返り記録
- **Action（改善）**: AI分析に基づく計画調整、新しい行動設定

#### AI連携機能
- クライアントの目標・タスク・ログの自動分析
- 個別アドバイス・フィードバックの生成
- COM:PASSサイクルの振り返り支援
- パーソナライズされた成長提案

#### 認証・アカウント管理
- メール＋パスワードによる登録・ログイン
- パスワードリセット
- プロフィール管理

### 2.2 ユーザーロールと権限

#### クライアント（ユーザー）
**アクセス可能な機能:**
- COM:PASS全機能（目標設定、タスク管理、ログ記録、振り返り、改善）
- AIアシスタントとの対話
- 自分のデータの閲覧・編集
- プロフィール・設定管理

**アクセス制限:**
- 他のユーザーのデータは閲覧・編集不可
- システム管理機能なし

#### ゲスト（未ログイン）
**アクセス可能な機能:**
- 認証ページ（ログイン・登録）のみ

### 2.3 認証・認可要件

**認証方式:**
- メール＋パスワード
- Auth.js (NextAuth v5)による実装
- パスワードリセット機能あり

**セキュリティ要件:**
- パスワードのbcryptハッシュ化（ソルトラウンド: 10）
- CSRF保護（Auth.js標準実装）
- JWT暗号化（JWE, A256GCM）
- HttpOnly Cookie（XSS攻撃防止）
- Secure Cookie（HTTPS必須、本番環境）
- パスワードポリシー: 8文字以上、英数字混在推奨

**セッション管理:**
- JWT戦略（サーバーレス対応）
- セッション有効期限: 30日間（更新可能）

**管理機能:**
- MVPでは不要（クライアント専用）

---

## 3. ページ詳細仕様

### 3.1 ページ一覧

MVPでは**6ページ**のみ実装：

#### 公開ページ（1ページ）

| ID | ページ名 | ルート | 権限レベル | 優先度 |
|----|---------|-------|----------|-------|
| P-001 | 認証ページ | `/auth` | 公開 | 高 |

#### クライアントページ（5ページ）

| ID | ページ名 | ルート | 権限レベル | 優先度 |
|----|---------|-------|----------|-------|
| C-001 | ホーム（ダッシュボード） | `/` | ユーザー | 高 |
| C-002 | 目標・実行ページ | `/plan-do` | ユーザー | 高 |
| C-003 | 振り返り・改善ページ | `/check-action` | ユーザー | 高 |
| C-004 | AIアシスタント | `/ai-assistant` | ユーザー | 高 |
| C-005 | 設定 | `/settings` | ユーザー | 中 |

### 3.2 P-001: 認証ページ

**ステータス**: ✅ 実装済み（E2E: 96.8%）

#### 主要機能
- メール＋パスワードによるログイン
- 新規ユーザー登録
- パスワードリセット（メール送信）

**詳細**: 実装コードを参照（`app/(auth)/auth/`, `app/api/auth/`, `lib/auth.ts`）

---

### 3.3 C-001: ホーム（ダッシュボード）

**ステータス**: ✅ 実装済み（E2E: 84.1%）

#### 主要機能
- COM:PASS進捗サマリー（4フェーズの進捗状況）
- 今日のタスク一覧
- 最近のアクティビティ
- 通知機能

**詳細**: 実装コードを参照（`app/(client)/client/`, `app/api/dashboard/`, `components/dashboard/`）

---

### 3.4 C-002: 目標・実行ページ（Plan-Do）

**ステータス**: ✅ 実装済み（E2E: 72.4%、改善中）

#### 主要機能
- 目標の作成・編集・削除
- 目標に紐づくタスク管理
- タスク完了チェック
- 日々のログ記録
- 進捗バー表示

**詳細**: 実装コードを参照（`app/(client)/client/plan-do/`, `app/api/goals/`, `app/api/tasks/`, `components/plan-do/`）

---

### 3.5 C-003: 振り返り・改善ページ（Check-Action）

**ステータス**: ✅ 実装済み（E2E: 74.1%、改善中）

#### 主要機能
- 期間別進捗確認（日次、週次、月次）
- データ可視化（グラフ、チャート）
- 振り返り記録
- AI分析レポート表示
- 改善計画の作成

**詳細**: 実装コードを参照（`app/(client)/client/check-action/`, `app/api/reflections/`, `app/api/analysis/`, `components/check-action/`）

---

### 3.6 C-004: AIアシスタント

**ステータス**: ✅ 実装済み（E2E: 76.0%、改善中）

#### 主要機能
- AIチャット機能（4モード対応）
  - 課題解決モード
  - 学習支援モード
  - 計画立案モード
  - 伴走補助モード
- コンテキスト理解（ユーザー目標・タスク・ログ）
- チャット履歴保存

**詳細**: 実装コードを参照（`app/(client)/client/ai-assistant/`, `app/api/chat/`, `app/api/ai-assistant/`, `components/chat/`）

---

### 3.7 C-005: 設定

**ステータス**: ✅ 実装済み（E2E: 100%）

#### 主要機能
- プロフィール編集（名前、メール）
- パスワード変更
- 通知設定
- メンター登録
- アカウント削除

**詳細**: 実装コードを参照（`app/(client)/client/settings/`, `app/api/users/`, `components/settings/`）

---

## 4. データモデル概要

**ステータス**: ✅ 実装済み（Prismaスキーマ: `prisma/schema.prisma`）

### 主要エンティティ（14モデル）

#### フェーズ1: クライアント機能
- **User** - ユーザー情報（role, isMentor拡張済み）
- **Session** - セッション管理
- **PasswordResetToken** - パスワードリセット
- **UserSettings** - ユーザー設定
- **Goal** - 目標管理
- **Task** - タスク管理
- **Log** - ログ記録
- **Reflection** - 振り返り
- **AIAnalysisReport** - AI分析レポート
- **ActionPlan** - 改善計画
- **ChatMessage** - AIチャット履歴（4モード対応）
- **Notification** - 通知

#### フェーズ2: メンター機能
- **MentorClientRelationship** - メンター-クライアント関係
- **ClientDataAccessPermission** - データアクセス権限
- **ClientDataViewLog** - 閲覧監査ログ
- **MentorNote** - メンターノート
- **ClientProgressReport** - 進捗レポート

**詳細**: `prisma/schema.prisma` と `types/index.ts` を参照

---

## 5. 制約事項

### 5.1 外部API制限

#### Anthropic Claude API（開発環境）
- **無料枠**: $10まで（約1.4ヶ月、10ユーザー想定）
- **Rate Limit**: 5リクエスト/分（Free Tier）
- **トークン制限**: 20,000トークン/分、300,000トークン/日
- **コンテキスト**: 200K トークン

#### OpenAI API（本番環境）
- **Rate Limit**: 500リクエスト/分（Tier 1）
- **トークン制限**: 30,000トークン/分（GPT-4o mini）
- **コンテキスト**: 128K トークン
- **コスト**: $0.15/100万入力トークン、$0.60/100万出力トークン

#### Supabase（データベース）
- **無料枠**: 500MB DB、50,000 MAU/月
- **接続制限**: 60同時接続
- **ストレージ**: 1GB

#### Vercel（フロントエンドホスティング）
- **無料枠**: 100GBバンドウィズ/月、無制限リクエスト
- **ビルド時間**: 6,000分/月

#### Google Cloud Run（バックエンドホスティング）
- **無料枠**: 200万リクエスト/月、180,000 vCPU秒、360,000 GiB秒メモリ

### 5.2 技術的制約

#### モバイルPWA制約
- **iOS Safari**: プッシュ通知非対応、ストレージ制限あり
- **オフライン対応**: Service Workerの容量制限
- **インストール**: ユーザー自身がホーム画面追加する必要

#### パフォーマンス制約
- **AI応答時間**: 3-10秒（ネットワーク状況による）
- **同時AI分析**: Rate Limit考慮で順次処理
- **データベースクエリ**: インデックス最適化必須

#### セキュリティ制約
- **HTTPS必須**: 本番環境ではHTTPSのみ
- **CORS設定**: フロントエンド-バックエンド間の適切な設定必要
- **環境変数**: APIキーは環境変数管理、Gitにコミットしない

---

## 6. 技術スタック

**ステータス**: ✅ 実装済み

### フロントエンド
- **React 19** + **Next.js 16** (App Router) + **TypeScript 5**
- **TailwindCSS** + **shadcn/ui**
- **Zustand**, **React Query**（TanStack Query）

### バックエンド
- **Next.js API Routes**（FastAPI統合は未実装）
- **Prisma ORM** + **PostgreSQL 16**（Supabase）

### 認証・認可
- **Auth.js v5**（NextAuth）+ **Data Access Layer**（DAL）
- **bcrypt**パスワードハッシュ化

### AI/ML
- **開発**: Anthropic Claude 3.5 Sonnet
- **本番**: OpenAI GPT-4o mini

### インフラ
- **フロントエンド**: Vercel（本番: https://mental-base-mvp.vercel.app）
- **データベース**: Supabase PostgreSQL
- **メール**: Resend
- **CI/CD**: GitHub Actions（未設定）

**詳細**: `package.json`, `prisma/schema.prisma`, `.env.example` を参照

---

## 7. 必要な外部サービス

**ステータス**: ✅ セットアップ済み

### 必須サービス
- **Anthropic Claude API** - 開発・テスト用AI（$10無料枠）
- **OpenAI API** - 本番用AI（GPT-4o mini）
- **Supabase** - PostgreSQL（無料枠）
- **Vercel** - フロントエンドホスティング（無料枠）

### オプションサービス
- **Resend** - パスワードリセットメール（無料枠: 100通/日）

**詳細**: `.env.example` を参照

---

## 8. 今後の拡張予定

### フェーズ2: メンター機能
**ステータス**: ✅ 実装完了（2025-11-02）

- ✅ メンターダッシュボード
- ✅ 複数クライアント管理
- ✅ クライアント詳細画面（6タブ）
- ✅ データアクセス制御（5種類の権限）
- ✅ メンターノート
- ✅ 進捗レポート

**詳細**: `docs/requirements_mentor.md` を参照

### フェーズ3: 高度な機能（計画中）
- メンターレビュー機能
- 検索・マッチング機能
- ビデオ通話統合
- 組織管理機能

### フェーズ4: AI機能高度化（計画中）
- AIパーソナライゼーション
- 予測分析（目標達成確率）
- 自動リマインダー最適化

### フェーズ5: 外部連携（計画中）
- ウェアラブルデバイス連携
- カレンダー連携（Google Calendar等）
- タスク管理ツール連携

---

## 9. 成功の定義

このMVPが成功したと判断する基準：

### 定量的基準
1. **10人のテストユーザーのうち、7人以上が2週間継続利用**
2. **AIフィードバックの満足度が5段階評価で平均4.0以上**
3. **週1回以上のAIアドバイスに基づく行動改善が確認できる**

### 定性的基準
1. **ユーザーが「AIのアドバイスが具体的で実践的」とフィードバック**
2. **「進捗が可視化されてモチベーションが維持できる」という評価**
3. **「システムが自分の成長を実感できる」という声が聞かれる**

---

**要件定義書 完**

**最終更新**: 2025-11-03（ドキュメント同期作業）

**注**: 実装済み詳細はコードを真実源として参照してください。
- **Prismaスキーマ**: `prisma/schema.prisma`
- **型定義**: `types/index.ts`
- **API仕様**: 各 `app/api/*/route.ts`
- **コンポーネント**: `components/`, `app/(client)/`, `app/(admin)/`
