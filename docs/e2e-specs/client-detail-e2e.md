# M-002: クライアント詳細 E2Eテスト仕様書

生成日: 2025-11-02
対象ページ: /mentor/client/[id]
テスト環境: モック実装（@MOCK_TO_API）
作成者: E2Eテスト仕様書作成エージェント

## 概要

- 総テスト項目数: 94項目
- 高優先度: 52項目
- 中優先度: 32項目
- 低優先度: 10項目

## テスト項目一覧

### 正常系テスト（36項目）

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 1 | E2E-CLIENT-001 | クライアント詳細ページアクセス | なし | 認可 | 正常系 | 高 | メンターロールでアクセス可能 | 1. メンターロールでログイン<br>2. /mentor/client/[id]にアクセス | ページが正常に表示される | | | DALパターンによる認可確認 |
| 2 | E2E-CLIENT-002 | 戻るボタン表示 | E2E-CLIENT-001 | 表示 | 正常系 | 高 | 戻るボタン表示 | /mentor/client/[id]アクセス後確認 | "メンターダッシュボードに戻る"リンク表示<br>矢印アイコン表示 | | | |
| 3 | E2E-CLIENT-003 | 戻るボタンクリック遷移 | E2E-CLIENT-002 | 遷移 | 正常系 | 高 | ダッシュボード遷移 | 戻るボタンをクリック | /mentorに遷移 | | | |
| 4 | E2E-CLIENT-004 | クライアント基本情報ヘッダー表示 | E2E-CLIENT-001 | 表示 | 正常系 | 高 | ヘッダー情報表示 | /mentor/client/[id]アクセス後確認 | アバター（イニシャル）<br>名前<br>メールアドレス<br>登録日<br>メンター関係開始日<br>表示 | | | |
| 5 | E2E-CLIENT-005 | クライアント基本情報取得成功 | E2E-CLIENT-004 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id] | clientInfo: {name, email, registeredAt, relationshipStartDate, overallProgress, status}表示 | | | @MOCK_TO_API |
| 6 | E2E-CLIENT-006 | 総合進捗率円グラフ表示 | E2E-CLIENT-005 | 表示 | 正常系 | 高 | 進捗率グラフ表示 | クライアント情報取得後確認 | SVG円グラフ表示<br>進捗率パーセント表示<br>"総合進捗率"ラベル表示 | | | |
| 7 | E2E-CLIENT-007 | 進捗率円グラフ色分け: 高進捗 | E2E-CLIENT-006 | 表示 | 正常系 | 中 | 進捗率70%以上の色 | overallProgress: 85 | 円グラフがstroke-green-500 | | | |
| 8 | E2E-CLIENT-008 | 進捗率円グラフ色分け: 中進捗 | E2E-CLIENT-006 | 表示 | 正常系 | 中 | 進捗率40-69%の色 | overallProgress: 50 | 円グラフがstroke-amber-500 | | | |
| 9 | E2E-CLIENT-009 | 進捗率円グラフ色分け: 低進捗 | E2E-CLIENT-006 | 表示 | 正常系 | 中 | 進捗率39%以下の色 | overallProgress: 30 | 円グラフがstroke-red-500 | | | |
| 10 | E2E-CLIENT-010 | クライアントステータスバッジ表示 | E2E-CLIENT-005 | 表示 | 正常系 | 高 | ステータスバッジ表示 | クライアント情報取得後確認 | ステータスアイコン<br>ステータスラベル（順調/停滞中/フォローアップ要）<br>バッジ色が正しい | | | CLIENT_STATUS_DISPLAY_MAP |
| 11 | E2E-CLIENT-011 | 進捗レポート生成ボタン表示 | E2E-CLIENT-001 | 表示 | 正常系 | 高 | ボタン表示 | /mentor/client/[id]アクセス後確認 | "進捗レポート生成"ボタン表示<br>アイコン表示 | | | |
| 12 | E2E-CLIENT-012 | データアクセス権限取得成功 | E2E-CLIENT-001 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id]/permissions | permissions: {allowGoals, allowTasks, allowLogs, allowReflections, allowAiReports}表示 | | | @MOCK_TO_API |
| 13 | E2E-CLIENT-013 | タブナビゲーション表示 | E2E-CLIENT-001 | 表示 | 正常系 | 高 | 6つのタブ表示 | /mentor/client/[id]アクセス後確認 | 目標一覧<br>タスク一覧<br>ログ履歴<br>振り返り<br>AI分析レポート<br>メンターノート<br>の6つのタブ表示 | | | |
| 14 | E2E-CLIENT-014 | タブ切り替え機能 | E2E-CLIENT-013 | UI/UX | 正常系 | 高 | タブ切り替え | 各タブをクリック | アクティブタブが青色ボーダーで強調表示<br>コンテンツエリアが切り替わる | | | |
| 15 | E2E-CLIENT-015 | 目標一覧タブ表示（権限あり） | E2E-CLIENT-012 | 表示 | 正常系 | 高 | 目標一覧表示 | allowGoals: true<br>目標一覧タブクリック | 目標カードが表示される<br>各カード: タイトル、説明、期限、進捗率、ステータスバッジ | | | |
| 16 | E2E-CLIENT-016 | 目標データ取得成功 | E2E-CLIENT-015 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id]/goals | goals: GoalWithProgress[]表示 | | | @MOCK_TO_API |
| 17 | E2E-CLIENT-017 | タスク一覧タブ表示（権限あり） | E2E-CLIENT-012 | 表示 | 正常系 | 高 | タスク一覧表示 | allowTasks: true<br>タスク一覧タブクリック | タスクカードが表示される<br>各カード: タイトル、期限、優先度バー、ステータスバッジ、目標名 | | | |
| 18 | E2E-CLIENT-018 | タスクデータ取得成功 | E2E-CLIENT-017 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id]/tasks | tasks: TaskWithGoal[]表示 | | | @MOCK_TO_API |
| 19 | E2E-CLIENT-019 | タスク優先度バー色分け: 高 | E2E-CLIENT-017 | 表示 | 正常系 | 中 | 優先度高の色 | priority: 'high' | 優先度バーが#e53e3e（赤） | | | TASK_PRIORITY_DISPLAY_MAP |
| 20 | E2E-CLIENT-020 | タスク優先度バー色分け: 中 | E2E-CLIENT-017 | 表示 | 正常系 | 中 | 優先度中の色 | priority: 'medium' | 優先度バーが#ecc94b（黄） | | | TASK_PRIORITY_DISPLAY_MAP |
| 21 | E2E-CLIENT-021 | タスク優先度バー色分け: 低 | E2E-CLIENT-017 | 表示 | 正常系 | 中 | 優先度低の色 | priority: 'low' | 優先度バーが#4299e1（青） | | | TASK_PRIORITY_DISPLAY_MAP |
| 22 | E2E-CLIENT-022 | ログ履歴タブ表示（権限あり） | E2E-CLIENT-012 | 表示 | 正常系 | 高 | ログ履歴表示 | allowLogs: true<br>ログ履歴タブクリック | ログカードが表示される<br>各カード: 内容、感情アイコン、状態、記録日時 | | | |
| 23 | E2E-CLIENT-023 | ログデータ取得成功 | E2E-CLIENT-022 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id]/logs | logs: Log[]表示 | | | @MOCK_TO_API |
| 24 | E2E-CLIENT-024 | 感情アイコン表示 | E2E-CLIENT-022 | 表示 | 正常系 | 中 | 感情アイコンマッピング | emotion: 'happy' | sentiment_satisfiedアイコン<br>ラベル"満足"<br>緑色 | | | EMOTION_DISPLAY_MAP |
| 25 | E2E-CLIENT-025 | 振り返りタブ表示（権限あり） | E2E-CLIENT-012 | 表示 | 正常系 | 高 | 振り返り表示 | allowReflections: true<br>振り返りタブクリック | 振り返りカードが表示される<br>各カード: 期間、成果、課題、作成日 | | | |
| 26 | E2E-CLIENT-026 | 振り返りデータ取得成功 | E2E-CLIENT-025 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id]/reflections | reflections: Reflection[]表示 | | | @MOCK_TO_API |
| 27 | E2E-CLIENT-027 | AI分析レポートタブ表示（権限あり） | E2E-CLIENT-012 | 表示 | 正常系 | 高 | AI分析レポート表示 | allowAiReports: true<br>AI分析レポートタブクリック | レポートカードが表示される<br>各カード: サマリー、洞察、推奨事項、信頼度 | | | |
| 28 | E2E-CLIENT-028 | AI分析レポートデータ取得成功 | E2E-CLIENT-027 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id]/ai-reports | aiReports: AIAnalysisReportDetailed[]表示 | | | @MOCK_TO_API |
| 29 | E2E-CLIENT-029 | メンターノートタブ表示 | E2E-CLIENT-001 | 表示 | 正常系 | 高 | メンターノート表示 | メンターノートタブクリック | 新規ノート作成ボタン表示<br>ノート一覧表示 | | | 権限不要 |
| 30 | E2E-CLIENT-030 | メンターノートデータ取得成功 | E2E-CLIENT-029 | データ取得 | 正常系 | 高 | API呼び出し成功 | モックAPI: /api/mentor/client/[id]/notes | notes: MentorNote[]表示 | | | @MOCK_TO_API |
| 31 | E2E-CLIENT-031 | メンターノート作成ボタンクリック | E2E-CLIENT-029 | UI/UX | 正常系 | 高 | フォーム表示切り替え | 新規ノート作成ボタンクリック | ノート作成フォームが表示される | | | |
| 32 | E2E-CLIENT-032 | メンターノート作成成功 | E2E-CLIENT-031 | 作成 | 正常系 | 高 | ノート作成 | 1. フォーム入力（タイトル、内容、タイプ、タグ）<br>2. 送信 | モックAPI: POST /api/mentor/client/[id]/notes<br>ノートが一覧に追加される<br>フォームが閉じる | | | @MOCK_TO_API |
| 33 | E2E-CLIENT-033 | メンターノート編集ボタンクリック | E2E-CLIENT-030 | UI/UX | 正常系 | 高 | 編集フォーム表示 | ノートの編集ボタンクリック | ノート内容が編集フォームに表示される | | | |
| 34 | E2E-CLIENT-034 | メンターノート更新成功 | E2E-CLIENT-033 | 更新 | 正常系 | 高 | ノート更新 | 1. フォーム編集<br>2. 送信 | モックAPI: PUT /api/mentor/client/[id]/notes/[noteId]<br>ノートが更新される<br>フォームが閉じる | | | @MOCK_TO_API |
| 35 | E2E-CLIENT-035 | メンターノート削除成功 | E2E-CLIENT-030 | 削除 | 正常系 | 高 | ノート削除 | 1. 削除ボタンクリック<br>2. 確認ダイアログでOK | モックAPI: DELETE /api/mentor/client/[id]/notes/[noteId]<br>ノートが一覧から削除される | | | @MOCK_TO_API |
| 36 | E2E-CLIENT-036 | メンターノートタイプバッジ表示 | E2E-CLIENT-030 | 表示 | 正常系 | 中 | タイプバッジ表示 | noteType: 'achievement' | バッジラベル"成果"<br>バッジ色が正しい | | | NOTE_TYPE_DISPLAY_MAP |

### 異常系テスト（22項目）

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 37 | E2E-CLIENT-037 | クライアント基本情報取得失敗 | E2E-CLIENT-004 | エラー | 異常系 | 高 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>エラーメッセージ"クライアント情報の読み込みに失敗しました"表示 | | | |
| 38 | E2E-CLIENT-038 | データアクセス権限取得失敗 | E2E-CLIENT-012 | エラー | 異常系 | 高 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>タブが表示されない、またはすべて権限なし状態 | | | |
| 39 | E2E-CLIENT-039 | 目標データ取得失敗 | E2E-CLIENT-016 | エラー | 異常系 | 中 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>ローディング状態が終了<br>空状態表示 | | | |
| 40 | E2E-CLIENT-040 | タスクデータ取得失敗 | E2E-CLIENT-018 | エラー | 異常系 | 中 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>ローディング状態が終了<br>空状態表示 | | | |
| 41 | E2E-CLIENT-041 | ログデータ取得失敗 | E2E-CLIENT-023 | エラー | 異常系 | 中 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>ローディング状態が終了<br>空状態表示 | | | |
| 42 | E2E-CLIENT-042 | 振り返りデータ取得失敗 | E2E-CLIENT-026 | エラー | 異常系 | 中 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>ローディング状態が終了<br>空状態表示 | | | |
| 43 | E2E-CLIENT-043 | AI分析レポートデータ取得失敗 | E2E-CLIENT-028 | エラー | 異常系 | 中 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>ローディング状態が終了<br>空状態表示 | | | |
| 44 | E2E-CLIENT-044 | メンターノートデータ取得失敗 | E2E-CLIENT-030 | エラー | 異常系 | 中 | APIエラー時の挙動 | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>ローディング状態が終了<br>空状態表示 | | | |
| 45 | E2E-CLIENT-045 | 目標データなし | E2E-CLIENT-015 | 表示 | 異常系 | 中 | 空状態の表示 | モックAPIで空配列返却 | 旗アイコン表示<br>"まだ目標がありません"メッセージ表示 | | | |
| 46 | E2E-CLIENT-046 | タスクデータなし | E2E-CLIENT-017 | 表示 | 異常系 | 中 | 空状態の表示 | モックAPIで空配列返却 | assignmentアイコン表示<br>"まだタスクがありません"メッセージ表示 | | | |
| 47 | E2E-CLIENT-047 | ログデータなし | E2E-CLIENT-022 | 表示 | 異常系 | 中 | 空状態の表示 | モックAPIで空配列返却 | 空状態メッセージ表示 | | | |
| 48 | E2E-CLIENT-048 | 振り返りデータなし | E2E-CLIENT-025 | 表示 | 異常系 | 中 | 空状態の表示 | モックAPIで空配列返却 | 空状態メッセージ表示 | | | |
| 49 | E2E-CLIENT-049 | AI分析レポートデータなし | E2E-CLIENT-027 | 表示 | 異常系 | 中 | 空状態の表示 | モックAPIで空配列返却 | 空状態メッセージ表示 | | | |
| 50 | E2E-CLIENT-050 | メンターノートデータなし | E2E-CLIENT-029 | 表示 | 異常系 | 中 | 空状態の表示 | モックAPIで空配列返却 | "まだノートがありません。新規ノートを作成してクライアントの観察記録を残しましょう。"メッセージ表示 | | | |
| 51 | E2E-CLIENT-051 | メンターノート作成失敗 | E2E-CLIENT-032 | エラー | 異常系 | 高 | 作成エラー | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>フォームは閉じない<br>エラーメッセージ表示（理想） | | | |
| 52 | E2E-CLIENT-052 | メンターノート更新失敗 | E2E-CLIENT-034 | エラー | 異常系 | 高 | 更新エラー | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>フォームは閉じない<br>エラーメッセージ表示（理想） | | | |
| 53 | E2E-CLIENT-053 | メンターノート削除失敗 | E2E-CLIENT-035 | エラー | 異常系 | 中 | 削除エラー | モックAPIでエラーレスポンス返却 | コンソールにエラーログ出力<br>ノートは削除されない<br>エラーメッセージ表示（理想） | | | |
| 54 | E2E-CLIENT-054 | メンターノート削除確認ダイアログキャンセル | E2E-CLIENT-035 | UI/UX | 異常系 | 低 | 削除キャンセル | 削除ボタンクリック後、確認ダイアログでキャンセル | ノートは削除されない<br>ダイアログが閉じる | | | |
| 55 | E2E-CLIENT-055 | メンターノートフォームキャンセル | E2E-CLIENT-031 | UI/UX | 異常系 | 低 | フォームキャンセル | フォーム表示後、キャンセルボタンクリック | フォームが閉じる<br>データは保存されない | | | |
| 56 | E2E-CLIENT-056 | 進捗率が範囲外（負の値） | E2E-CLIENT-006 | データ検証 | 異常系 | 低 | 異常値時の表示 | overallProgress: -10 | 進捗率が0%表示<br>エラーが発生しない | | | |
| 57 | E2E-CLIENT-057 | 進捗率が範囲外（100超） | E2E-CLIENT-006 | データ検証 | 異常系 | 低 | 異常値時の表示 | overallProgress: 150 | 進捗率が100%表示<br>エラーが発生しない | | | |
| 58 | E2E-CLIENT-058 | ネットワーク切断 | E2E-CLIENT-001 | エラー | 異常系 | 中 | ネットワークエラー | ページ読み込み後にネットワーク切断 | タイムアウト後にエラーハンドリング<br>ユーザーフレンドリーなエラーメッセージ | | | |

### セキュリティテスト（16項目）

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 59 | E2E-CLIENT-059 | ロール検証: CLIENT | なし | 認可 | セキュリティ | 高 | CLIENTロールアクセス拒否 | 1. CLIENTロールでログイン<br>2. /mentor/client/[id]にアクセス | /unauthorizedにリダイレクト<br>または403エラー | | | verifyMentor()による検証 |
| 60 | E2E-CLIENT-060 | ロール検証: 未認証 | なし | 認可 | セキュリティ | 高 | 未認証アクセス拒否 | 1. ログアウト状態<br>2. /mentor/client/[id]にアクセス | /authにリダイレクト<br>verifySession()で拒否 | | | DALパターン |
| 61 | E2E-CLIENT-061 | メンター-クライアント関係検証 | E2E-CLIENT-001 | 認可 | セキュリティ | 高 | 担当外クライアント拒否 | 1. メンターAでログイン<br>2. メンターBの担当クライアントIDでアクセス | 403エラーまたはアクセス拒否メッセージ | | | MentorClientRelationship確認 |
| 62 | E2E-CLIENT-062 | データアクセス権限検証: 目標 | E2E-CLIENT-015 | 認可 | セキュリティ | 高 | 権限なしアクセス制御 | allowGoals: false<br>目標一覧タブクリック | lockアイコン表示<br>"アクセス権限がありません"メッセージ<br>"このクライアントはこのデータの閲覧を許可していません。"サブメッセージ | | | |
| 63 | E2E-CLIENT-063 | データアクセス権限検証: タスク | E2E-CLIENT-017 | 認可 | セキュリティ | 高 | 権限なしアクセス制御 | allowTasks: false<br>タスク一覧タブクリック | lockアイコン表示<br>"アクセス権限がありません"メッセージ | | | |
| 64 | E2E-CLIENT-064 | データアクセス権限検証: ログ | E2E-CLIENT-022 | 認可 | セキュリティ | 高 | 権限なしアクセス制御 | allowLogs: false<br>ログ履歴タブクリック | lockアイコン表示<br>"アクセス権限がありません"メッセージ | | | |
| 65 | E2E-CLIENT-065 | データアクセス権限検証: 振り返り | E2E-CLIENT-025 | 認可 | セキュリティ | 高 | 権限なしアクセス制御 | allowReflections: false<br>振り返りタブクリック | lockアイコン表示<br>"アクセス権限がありません"メッセージ | | | |
| 66 | E2E-CLIENT-066 | データアクセス権限検証: AI分析レポート | E2E-CLIENT-027 | 認可 | セキュリティ | 高 | 権限なしアクセス制御 | allowAiReports: false<br>AI分析レポートタブクリック | lockアイコン表示<br>"アクセス権限がありません"メッセージ | | | |
| 67 | E2E-CLIENT-067 | XSS対策: クライアント名 | E2E-CLIENT-004 | セキュリティ | セキュリティ | 高 | XSS攻撃対策 | name: "<script>alert('XSS')</script>" | スクリプトが実行されない<br>エスケープされた文字列として表示 | | | |
| 68 | E2E-CLIENT-068 | XSS対策: メンターノート内容 | E2E-CLIENT-030 | セキュリティ | セキュリティ | 高 | XSS攻撃対策 | content: "<img src=x onerror=alert('XSS')>" | スクリプトが実行されない<br>エスケープされた文字列として表示 | | | |
| 69 | E2E-CLIENT-069 | CSRF対策 | E2E-CLIENT-032 | セキュリティ | セキュリティ | 中 | CSRF保護確認 | CSRFトークンなしでPOSTリクエスト | リクエストが拒否される | | | Auth.js実装時 |
| 70 | E2E-CLIENT-070 | セッション検証 | E2E-CLIENT-001 | セキュリティ | セキュリティ | 高 | セッションの有効性確認 | 1. ログイン<br>2. セッション期限切れ<br>3. ページ操作 | /authにリダイレクト<br>または401エラー | | | verifySession()による検証 |
| 71 | E2E-CLIENT-071 | SQL Injection対策: メンターノート | E2E-CLIENT-032 | セキュリティ | セキュリティ | 高 | SQLインジェクション対策 | title: "'; DROP TABLE mentor_notes; --" | SQLインジェクションが発生しない<br>Prisma ORMによる自動エスケープ | | | |
| 72 | E2E-CLIENT-072 | API認証ヘッダー検証 | E2E-CLIENT-005 | セキュリティ | セキュリティ | 中 | 認証ヘッダー必須確認 | 認証ヘッダーなしでAPIリクエスト | 401 Unauthorizedエラー | | | |
| 73 | E2E-CLIENT-073 | データ閲覧ログ記録 | E2E-CLIENT-016 | セキュリティ | セキュリティ | 高 | 監査ログ記録 | 目標データ閲覧 | ClientDataViewLogにレコード作成<br>mentorId, clientId, dataType, dataId, action: 'view'が記録される | | | GDPR対応 |
| 74 | E2E-CLIENT-074 | 他メンターのノート表示防止 | E2E-CLIENT-030 | セキュリティ | セキュリティ | 高 | データアクセス制御 | 1. メンターAでログイン<br>2. ノート一覧取得 | メンターA作成のノートのみ表示<br>他メンター作成のノートは表示されない | | | |

### レスポンシブテスト（10項目）

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 75 | E2E-CLIENT-075 | デスクトップ表示（1920x1080） | E2E-CLIENT-001 | レスポンシブ | レスポンシブ | 高 | デスクトップ最適表示 | ビューポート: 1920x1080<br>/mentor/client/[id]アクセス | ヘッダー情報が横並びで表示<br>タブが横並びで表示<br>すべての要素が適切に表示 | | | |
| 76 | E2E-CLIENT-076 | タブレット表示（1024x768） | E2E-CLIENT-001 | レスポンシブ | レスポンシブ | 高 | タブレット表示調整 | ビューポート: 1024x768<br>/mentor/client/[id]アクセス | ヘッダー情報が適切に表示<br>タブがスクロール可能（overflow-x-auto） | | | |
| 77 | E2E-CLIENT-077 | モバイル表示（375x667） | E2E-CLIENT-001 | レスポンシブ | レスポンシブ | 高 | モバイル表示調整 | ビューポート: 375x667<br>/mentor/client/[id]アクセス | ヘッダー情報が縦並び<br>進捗円グラフが小さく表示<br>タブがスクロール可能 | | | |
| 78 | E2E-CLIENT-078 | タブナビゲーションのスクロール | E2E-CLIENT-013 | レスポンシブ | レスポンシブ | 中 | 小画面でのタブスクロール | ビューポート: 375x667<br>タブを左右スクロール | 6つのタブが横スクロール可能<br>overflow-x-autoが機能 | | | |
| 79 | E2E-CLIENT-079 | 進捗円グラフのレスポンシブ | E2E-CLIENT-006 | レスポンシブ | レスポンシブ | 中 | 小画面での円グラフ | ビューポート: 375x667 | 円グラフが適切なサイズで表示<br>レイアウト崩れなし | | | |
| 80 | E2E-CLIENT-080 | メンターノートフォームのレスポンシブ | E2E-CLIENT-031 | レスポンシブ | レスポンシブ | 中 | 小画面でのフォーム | ビューポート: 375x667<br>ノート作成フォーム表示 | フォームが画面幅に収まる<br>入力フィールドが適切に表示 | | | |
| 81 | E2E-CLIENT-081 | 目標カードのレスポンシブ | E2E-CLIENT-015 | レスポンシブ | レスポンシブ | 中 | 小画面での目標カード | ビューポート: 375x667<br>目標一覧タブ表示 | カードが画面幅に収まる<br>テキストが折り返される | | | |
| 82 | E2E-CLIENT-082 | タスクカードのレスポンシブ | E2E-CLIENT-017 | レスポンシブ | レスポンシブ | 中 | 小画面でのタスクカード | ビューポート: 375x667<br>タスク一覧タブ表示 | カードが画面幅に収まる<br>優先度バーが適切に表示 | | | |
| 83 | E2E-CLIENT-083 | 横向き表示（667x375） | E2E-CLIENT-001 | レスポンシブ | レスポンシブ | 低 | 横向き対応 | ビューポート: 667x375<br>/mentor/client/[id]アクセス | すべての要素が表示される<br>スクロール可能 | | | |
| 84 | E2E-CLIENT-084 | 極小画面（320x568） | E2E-CLIENT-001 | レスポンシブ | レスポンシブ | 低 | 極小画面対応 | ビューポート: 320x568<br>/mentor/client/[id]アクセス | すべての要素が表示される<br>レイアウト崩れなし | | | |

### ワークフローテスト（10項目）

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 85 | E2E-CLIENT-085 | ワークフロー: 初回アクセス | E2E-CLIENT-001 | ワークフロー | ワークフロー | 高 | 初回利用の全体フロー | 1. メンターロールでログイン<br>2. /mentor/client/[id]アクセス<br>3. ヘッダー、タブ、権限確認 | すべてのデータが正常に表示される<br>ローディング→データ表示の遷移がスムーズ | | | |
| 86 | E2E-CLIENT-086 | ワークフロー: タブ切り替え→データ閲覧 | E2E-CLIENT-014 | ワークフロー | ワークフロー | 高 | タブ切り替えフロー | 1. 目標一覧タブクリック<br>2. タスク一覧タブクリック<br>3. ログ履歴タブクリック | 各タブでデータが正しく表示される<br>APIが各タブで1回ずつ呼び出される | | | |
| 87 | E2E-CLIENT-087 | ワークフロー: メンターノート作成→編集→削除 | E2E-CLIENT-032, E2E-CLIENT-034, E2E-CLIENT-035 | ワークフロー | ワークフロー | 高 | ノートCRUDフロー | 1. ノート作成<br>2. 作成したノート編集<br>3. 編集したノート削除 | CRUD操作が正常に完了<br>各操作後にデータが正しく更新される | | | |
| 88 | E2E-CLIENT-088 | ワークフロー: 戻る→詳細→戻る | E2E-CLIENT-003 | ワークフロー | ワークフロー | 中 | ナビゲーションフロー | 1. /mentorから/mentor/client/[id]に遷移<br>2. 戻るボタンクリック<br>3. 再度同じクライアントカードクリック | 遷移がスムーズ<br>データが保持される | | | |
| 89 | E2E-CLIENT-089 | ワークフロー: 権限なしタブ確認 | E2E-CLIENT-062 | ワークフロー | ワークフロー | 中 | 権限なし時のフロー | 1. すべての権限がfalseのクライアント<br>2. 各タブクリック | すべてのタブで権限なしメッセージ表示<br>メンターノートタブのみ正常表示 | | | |
| 90 | E2E-CLIENT-090 | ワークフロー: エラーからの回復 | E2E-CLIENT-037 | ワークフロー | ワークフロー | 中 | エラー回復フロー | 1. APIエラー発生<br>2. ページリロード<br>3. データ再取得確認 | リロード後に正常にデータが表示される | | | |
| 91 | E2E-CLIENT-091 | ワークフロー: ブラウザバック | E2E-CLIENT-003 | ワークフロー | ワークフロー | 中 | ブラウザバック対応 | 1. クライアント詳細ページ表示<br>2. タブ切り替え<br>3. ブラウザバックボタン | ダッシュボードに戻る | | | URLパラメータでタブ状態保持は未実装 |
| 92 | E2E-CLIENT-092 | ワークフロー: 進捗レポート生成（将来実装） | E2E-CLIENT-011 | ワークフロー | ワークフロー | 低 | レポート生成フロー | 進捗レポート生成ボタンクリック | モーダルまたは新規ページでレポート生成フォーム表示 | | | 将来実装予定 |
| 93 | E2E-CLIENT-093 | ワークフロー: データなし→権限リクエスト（将来実装） | E2E-CLIENT-062 | ワークフロー | ワークフロー | 低 | 権限リクエストフロー | 1. 権限なしメッセージ確認<br>2. "許可をリクエスト"ボタンクリック | クライアントに権限リクエスト通知送信 | | | 将来実装予定 |
| 94 | E2E-CLIENT-094 | ワークフロー: メンターノート公開/非公開切り替え | E2E-CLIENT-032 | ワークフロー | ワークフロー | 中 | 公開設定フロー | 1. ノート作成時にisSharedWithClient: true<br>2. 公開アイコン確認<br>3. 編集してfalseに変更<br>4. 非公開アイコン確認 | 公開/非公開が正しく切り替わる<br>アイコンが"public"/"lock"で変化 | | | |

## テスト分類別カバレッジ

- **正常系**: 36項目
  - ページアクセス、表示、データ取得、タブ切り替え、CRUD操作、UI/UX、遷移
- **異常系**: 22項目
  - APIエラー、空状態、データ検証、ネットワークエラー、UI操作キャンセル
- **セキュリティ**: 16項目
  - 認可、ロール検証、データアクセス制御、XSS、CSRF、セッション、SQL Injection、監査ログ
- **レスポンシブ**: 10項目
  - デスクトップ、タブレット、モバイル、横向き、極小画面、コンポーネント別レスポンシブ
- **ワークフロー**: 10項目
  - 初回アクセス、タブ切り替え、CRUD操作、ナビゲーション、エラー回復、ブラウザバック

## API呼び出し一覧

| No | メソッド | エンドポイント | 用途 | テストID | 備考 |
|----|---------|--------------|------|----------|------|
| 1 | GET | /api/mentor/client/[id] | クライアント詳細取得 | E2E-CLIENT-005 | @MOCK_TO_API |
| 2 | GET | /api/mentor/client/[id]/permissions | データアクセス権限取得 | E2E-CLIENT-012 | @MOCK_TO_API |
| 3 | GET | /api/mentor/client/[id]/goals | 目標一覧取得 | E2E-CLIENT-016 | @MOCK_TO_API |
| 4 | GET | /api/mentor/client/[id]/tasks | タスク一覧取得 | E2E-CLIENT-018 | @MOCK_TO_API |
| 5 | GET | /api/mentor/client/[id]/logs | ログ履歴取得 | E2E-CLIENT-023 | @MOCK_TO_API |
| 6 | GET | /api/mentor/client/[id]/reflections | 振り返り一覧取得 | E2E-CLIENT-026 | @MOCK_TO_API |
| 7 | GET | /api/mentor/client/[id]/ai-reports | AI分析レポート一覧取得 | E2E-CLIENT-028 | @MOCK_TO_API |
| 8 | GET | /api/mentor/client/[id]/notes | メンターノート一覧取得 | E2E-CLIENT-030 | @MOCK_TO_API |
| 9 | POST | /api/mentor/client/[id]/notes | メンターノート作成 | E2E-CLIENT-032 | @MOCK_TO_API |
| 10 | PUT | /api/mentor/client/[id]/notes/[noteId] | メンターノート更新 | E2E-CLIENT-034 | @MOCK_TO_API |
| 11 | DELETE | /api/mentor/client/[id]/notes/[noteId] | メンターノート削除 | E2E-CLIENT-035 | @MOCK_TO_API |

## 優先度別実施順序

### 高優先度（必須）: 52項目

**認可・セキュリティ（依存なし）**:
- E2E-CLIENT-001: クライアント詳細ページアクセス
- E2E-CLIENT-059: ロール検証: CLIENT
- E2E-CLIENT-060: ロール検証: 未認証
- E2E-CLIENT-061: メンター-クライアント関係検証

**ヘッダー・基本表示**:
- E2E-CLIENT-002: 戻るボタン表示
- E2E-CLIENT-003: 戻るボタンクリック遷移
- E2E-CLIENT-004: クライアント基本情報ヘッダー表示
- E2E-CLIENT-005: クライアント基本情報取得成功
- E2E-CLIENT-006: 総合進捗率円グラフ表示
- E2E-CLIENT-010: クライアントステータスバッジ表示
- E2E-CLIENT-011: 進捗レポート生成ボタン表示

**データアクセス権限**:
- E2E-CLIENT-012: データアクセス権限取得成功
- E2E-CLIENT-062: データアクセス権限検証: 目標
- E2E-CLIENT-063: データアクセス権限検証: タスク
- E2E-CLIENT-064: データアクセス権限検証: ログ
- E2E-CLIENT-065: データアクセス権限検証: 振り返り
- E2E-CLIENT-066: データアクセス権限検証: AI分析レポート

**タブナビゲーション**:
- E2E-CLIENT-013: タブナビゲーション表示
- E2E-CLIENT-014: タブ切り替え機能

**各タブ表示・データ取得**:
- E2E-CLIENT-015: 目標一覧タブ表示（権限あり）
- E2E-CLIENT-016: 目標データ取得成功
- E2E-CLIENT-017: タスク一覧タブ表示（権限あり）
- E2E-CLIENT-018: タスクデータ取得成功
- E2E-CLIENT-022: ログ履歴タブ表示（権限あり）
- E2E-CLIENT-023: ログデータ取得成功
- E2E-CLIENT-025: 振り返りタブ表示（権限あり）
- E2E-CLIENT-026: 振り返りデータ取得成功
- E2E-CLIENT-027: AI分析レポートタブ表示（権限あり）
- E2E-CLIENT-028: AI分析レポートデータ取得成功
- E2E-CLIENT-029: メンターノートタブ表示
- E2E-CLIENT-030: メンターノートデータ取得成功

**メンターノートCRUD**:
- E2E-CLIENT-031: メンターノート作成ボタンクリック
- E2E-CLIENT-032: メンターノート作成成功
- E2E-CLIENT-033: メンターノート編集ボタンクリック
- E2E-CLIENT-034: メンターノート更新成功
- E2E-CLIENT-035: メンターノート削除成功

**エラーハンドリング**:
- E2E-CLIENT-037: クライアント基本情報取得失敗
- E2E-CLIENT-038: データアクセス権限取得失敗
- E2E-CLIENT-051: メンターノート作成失敗
- E2E-CLIENT-052: メンターノート更新失敗

**セキュリティ**:
- E2E-CLIENT-067: XSS対策: クライアント名
- E2E-CLIENT-068: XSS対策: メンターノート内容
- E2E-CLIENT-070: セッション検証
- E2E-CLIENT-071: SQL Injection対策: メンターノート
- E2E-CLIENT-073: データ閲覧ログ記録
- E2E-CLIENT-074: 他メンターのノート表示防止

**レスポンシブ**:
- E2E-CLIENT-075: デスクトップ表示（1920x1080）
- E2E-CLIENT-076: タブレット表示（1024x768）
- E2E-CLIENT-077: モバイル表示（375x667）

**ワークフロー**:
- E2E-CLIENT-085: ワークフロー: 初回アクセス
- E2E-CLIENT-086: ワークフロー: タブ切り替え→データ閲覧
- E2E-CLIENT-087: ワークフロー: メンターノート作成→編集→削除

### 中優先度（推奨）: 32項目

**表示詳細**:
- E2E-CLIENT-007 ~ E2E-CLIENT-009: 進捗率円グラフ色分け
- E2E-CLIENT-019 ~ E2E-CLIENT-021: タスク優先度バー色分け
- E2E-CLIENT-024: 感情アイコン表示
- E2E-CLIENT-036: メンターノートタイプバッジ表示

**エラーハンドリング**:
- E2E-CLIENT-039 ~ E2E-CLIENT-044: 各タブデータ取得失敗
- E2E-CLIENT-045 ~ E2E-CLIENT-050: 各タブ空状態表示
- E2E-CLIENT-053: メンターノート削除失敗
- E2E-CLIENT-058: ネットワーク切断

**セキュリティ**:
- E2E-CLIENT-069: CSRF対策
- E2E-CLIENT-072: API認証ヘッダー検証

**レスポンシブ**:
- E2E-CLIENT-078 ~ E2E-CLIENT-082: 各コンポーネントレスポンシブ

**ワークフロー**:
- E2E-CLIENT-088: ワークフロー: 戻る→詳細→戻る
- E2E-CLIENT-089: ワークフロー: 権限なしタブ確認
- E2E-CLIENT-090: ワークフロー: エラーからの回復
- E2E-CLIENT-091: ワークフロー: ブラウザバック
- E2E-CLIENT-094: ワークフロー: メンターノート公開/非公開切り替え

### 低優先度（任意）: 10項目

**UI/UX詳細**:
- E2E-CLIENT-054: メンターノート削除確認ダイアログキャンセル
- E2E-CLIENT-055: メンターノートフォームキャンセル

**データ検証（エッジケース）**:
- E2E-CLIENT-056 ~ E2E-CLIENT-057: 進捗率範囲外

**レスポンシブ（極小画面）**:
- E2E-CLIENT-083 ~ E2E-CLIENT-084: 横向き、極小画面

**将来実装**:
- E2E-CLIENT-092: ワークフロー: 進捗レポート生成（将来実装）
- E2E-CLIENT-093: ワークフロー: データなし→権限リクエスト（将来実装）

## 前提条件

### テストアカウント

**メンター**:
- メールアドレス: mentor@mentalbase.local
- パスワード: MentorTest2025!
- ロール: MENTOR
- ID: mentor-1

**クライアント**:
- メールアドレス: client@mentalbase.local
- パスワード: ClientTest2025!
- ロール: CLIENT
- ID: client-1

**メンター-クライアント関係**:
- relationshipId: rel-001
- mentorId: mentor-1
- clientId: client-1
- status: active

### テストデータ

**クライアント基本情報（モック）**:
```json
{
  "clientInfo": {
    "id": "client-1",
    "name": "田中太郎",
    "email": "tanaka@example.com",
    "initials": "田",
    "registeredAt": "2025-01-15T00:00:00Z",
    "relationshipStartDate": "2025-01-20T00:00:00Z",
    "overallProgress": 85,
    "status": "on_track"
  }
}
```

**データアクセス権限（モック）**:
```json
{
  "permissions": {
    "id": "perm-1",
    "relationshipId": "rel-1",
    "clientId": "client-1",
    "allowGoals": true,
    "allowTasks": true,
    "allowLogs": true,
    "allowReflections": true,
    "allowAiReports": true,
    "isActive": true,
    "createdAt": "2025-01-20T00:00:00Z",
    "updatedAt": "2025-01-20T00:00:00Z"
  }
}
```

**目標データ（モック）**: 3件
**タスクデータ（モック）**: 3件
**ログデータ（モック）**: 3件
**振り返りデータ（モック）**: 2件
**AI分析レポートデータ（モック）**: 1件
**メンターノートデータ（モック）**: 3件

詳細は`services/mock/ClientDetailService.ts`を参照

### 環境要件

- Node.js: 18.17以上
- ブラウザ: Chrome、Firefox、Safari、Edge（最新版）
- テストフレームワーク: Playwright
- モックAPI: MSW（Mock Service Worker）または Next.js API Routes

## 実装状況

- **実装完了**: 2025-11-02
  - ページコンポーネント: `app/(protected)/mentor/client/[id]/page.tsx`
  - ヘッダーコンポーネント: `components/mentor/ClientDetailHeader.tsx`
  - タブコンポーネント: `components/mentor/ClientTabs.tsx`
  - 各タブコンポーネント: `components/mentor/tabs/*.tsx`
  - モックサービス: `services/mock/ClientDetailService.ts`
  - 型定義: `types/index.ts`
  - DAL（認可）: `lib/dal.ts`
  - API仕様書: `docs/api-specs/client-detail-api.md`

- **未実装**:
  - モックAPI実装（@MOCK_TO_APIマーク箇所）
  - E2Eテスト（Playwright）
  - 進捗レポート生成機能
  - 権限リクエスト機能
  - 実際のデータベース接続

## 注意事項

### テスト実施時の注意

1. **認可テスト**: `verifyMentor()`による検証が正しく動作することを確認
2. **メンター-クライアント関係**: MentorClientRelationshipテーブルでの関係確認が必須
3. **データアクセス制御**: ClientDataAccessPermissionに基づく細かいアクセス制御を確認
4. **監査ログ**: ClientDataViewLogにデータ閲覧履歴が記録されることを確認（GDPR対応）
5. **@MOCK_TO_API**: モックAPIを先に実装し、本番API実装後に置き換え
6. **XSS対策**: React自動エスケープに加え、`dangerouslySetInnerHTML`を使用していないことを確認
7. **レスポンシブ**: タブナビゲーションのoverflow-x-autoが正しく動作することを確認
8. **日付フォーマット**: `toLocaleDateString('ja-JP')`での日本語日付表示を確認

### 既知の制約

- 進捗レポート生成機能は将来実装予定（現在はボタンのみ）
- 権限リクエスト機能は将来実装予定
- メンターノートのリンク機能（linkedDataType, linkedDataId）は現在未使用
- クライアントデータのリアルタイム更新は将来実装予定
- タブ状態のURLパラメータ保持は未実装

### デザインシステム準拠

すべてのコンポーネントはデザインシステムのCSS変数またはTailwind CSSクラスを使用:
- 色: `bg-blue-600`, `text-gray-900`, `stroke-green-500`等
- シャドウ: `shadow-sm`, `shadow-md`
- スペーシング: `px-4`, `py-6`, `gap-3`等
- レスポンシブ: `sm:`, `md:`, `lg:`ブレークポイント

### セキュリティ要件

1. **認証・認可**: すべてのページで`verifyMentor()`実行
2. **データアクセス制御**: クライアントの許可に基づくデータ閲覧
3. **監査ログ**: すべてのデータ閲覧を`ClientDataViewLog`に記録
4. **GDPR対応**: クライアントはいつでもアクセス権を取り消し可能
5. **XSS対策**: Reactの自動エスケープ
6. **SQL Injection対策**: Prisma ORMの自動エスケープ
7. **CSRF対策**: Auth.js v5のCSRF保護

---

**最終更新**: 2025-11-02
**次回更新予定**: モックAPI実装完了後
